{"version":3,"sources":["../../../src/telemetry/events/version.ts"],"sourcesContent":["import type { NextConfigComplete } from '../../server/config-shared'\n\nconst EVENT_VERSION = 'NEXT_CLI_SESSION_STARTED'\n\ntype EventCliSessionStarted = {\n  nextVersion: string\n  nodeVersion: string\n  cliCommand: string\n  isSrcDir: boolean | null\n  hasNowJson: boolean\n  isCustomServer: boolean | null\n  hasNextConfig: boolean\n  buildTarget: string\n  hasWebpackConfig: boolean\n  hasBabelConfig: boolean\n  basePathEnabled: boolean\n  i18nEnabled: boolean\n  imageEnabled: boolean\n  imageFutureEnabled: boolean\n  locales: string | null\n  localeDomainsCount: number | null\n  localeDetectionEnabled: boolean | null\n  imageDomainsCount: number | null\n  imageRemotePatternsCount: number | null\n  imageLocalPatternsCount: number | null\n  imageQualities: string | null\n  imageSizes: string | null\n  imageLoader: string | null\n  imageFormats: string | null\n  nextConfigOutput: string | null\n  trailingSlashEnabled: boolean\n  reactStrictMode: boolean\n  webpackVersion: number | null\n  turboFlag: boolean\n  isRspack: boolean\n  appDir: boolean | null\n  pagesDir: boolean | null\n  staticStaleTime: number | null\n  dynamicStaleTime: number | null\n  reactCompiler: boolean\n  reactCompilerCompilationMode: string | null\n  reactCompilerPanicThreshold: string | null\n}\n\nexport function eventCliSession(\n  nextConfig: NextConfigComplete,\n  event: Omit<\n    EventCliSessionStarted,\n    | 'nextVersion'\n    | 'nodeVersion'\n    | 'hasNextConfig'\n    | 'buildTarget'\n    | 'hasWebpackConfig'\n    | 'hasBabelConfig'\n    | 'basePathEnabled'\n    | 'i18nEnabled'\n    | 'imageEnabled'\n    | 'imageFutureEnabled'\n    | 'locales'\n    | 'localeDomainsCount'\n    | 'localeDetectionEnabled'\n    | 'imageDomainsCount'\n    | 'imageRemotePatternsCount'\n    | 'imageLocalPatternsCount'\n    | 'imageQualities'\n    | 'imageSizes'\n    | 'imageLoader'\n    | 'imageFormats'\n    | 'nextConfigOutput'\n    | 'trailingSlashEnabled'\n    | 'reactStrictMode'\n    | 'staticStaleTime'\n    | 'dynamicStaleTime'\n    | 'reactCompiler'\n    | 'reactCompilerCompilationMode'\n    | 'reactCompilerPanicThreshold'\n    | 'isRspack'\n  >\n): { eventName: string; payload: EventCliSessionStarted }[] {\n  // This should be an invariant, if it fails our build tooling is broken.\n  if (typeof process.env.__NEXT_VERSION !== 'string') {\n    return []\n  }\n\n  const { images, i18n } = nextConfig || {}\n\n  const payload: EventCliSessionStarted = {\n    nextVersion: process.env.__NEXT_VERSION,\n    nodeVersion: process.version,\n    cliCommand: event.cliCommand,\n    isSrcDir: event.isSrcDir,\n    hasNowJson: event.hasNowJson,\n    isCustomServer: event.isCustomServer,\n    hasNextConfig: nextConfig.configOrigin !== 'default',\n    buildTarget: 'default',\n    hasWebpackConfig: typeof nextConfig?.webpack === 'function',\n    hasBabelConfig: false,\n    imageEnabled: !!images,\n    imageFutureEnabled: !!images,\n    basePathEnabled: !!nextConfig?.basePath,\n    i18nEnabled: !!i18n,\n    locales: i18n?.locales ? i18n.locales.join(',') : null,\n    localeDomainsCount: i18n?.domains ? i18n.domains.length : null,\n    localeDetectionEnabled: !i18n ? null : i18n.localeDetection !== false,\n    imageDomainsCount: images?.domains ? images.domains.length : null,\n    imageRemotePatternsCount: images?.remotePatterns\n      ? images.remotePatterns.length\n      : null,\n    imageLocalPatternsCount: images?.localPatterns\n      ? images.localPatterns.length\n      : null,\n    imageSizes: images?.imageSizes ? images.imageSizes.join(',') : null,\n    imageQualities: images?.qualities ? images.qualities.join(',') : null,\n    imageLoader: images?.loader,\n    imageFormats: images?.formats ? images.formats.join(',') : null,\n    nextConfigOutput: nextConfig?.output || null,\n    trailingSlashEnabled: !!nextConfig?.trailingSlash,\n    reactStrictMode: !!nextConfig?.reactStrictMode,\n    webpackVersion: event.webpackVersion || null,\n    turboFlag: event.turboFlag || false,\n    isRspack: process.env.NEXT_RSPACK !== undefined,\n    appDir: event.appDir,\n    pagesDir: event.pagesDir,\n    staticStaleTime: nextConfig.experimental.staleTimes?.static ?? null,\n    dynamicStaleTime: nextConfig.experimental.staleTimes?.dynamic ?? null,\n    reactCompiler: Boolean(nextConfig.reactCompiler),\n    reactCompilerCompilationMode:\n      typeof nextConfig.reactCompiler !== 'boolean'\n        ? (nextConfig.reactCompiler?.compilationMode ?? null)\n        : null,\n    reactCompilerPanicThreshold:\n      typeof nextConfig.reactCompiler !== 'boolean'\n        ? (nextConfig.reactCompiler?.panicThreshold ?? null)\n        : null,\n  }\n  return [{ eventName: EVENT_VERSION, payload }]\n}\n"],"names":["eventCliSession","EVENT_VERSION","nextConfig","event","process","env","__NEXT_VERSION","images","i18n","payload","nextVersion","nodeVersion","version","cliCommand","isSrcDir","hasNowJson","isCustomServer","hasNextConfig","configOrigin","buildTarget","hasWebpackConfig","webpack","hasBabelConfig","imageEnabled","imageFutureEnabled","basePathEnabled","basePath","i18nEnabled","locales","join","localeDomainsCount","domains","length","localeDetectionEnabled","localeDetection","imageDomainsCount","imageRemotePatternsCount","remotePatterns","imageLocalPatternsCount","localPatterns","imageSizes","imageQualities","qualities","imageLoader","loader","imageFormats","formats","nextConfigOutput","output","trailingSlashEnabled","trailingSlash","reactStrictMode","webpackVersion","turboFlag","isRspack","NEXT_RSPACK","undefined","appDir","pagesDir","staticStaleTime","experimental","staleTimes","static","dynamicStaleTime","dynamic","reactCompiler","Boolean","reactCompilerCompilationMode","compilationMode","reactCompilerPanicThreshold","panicThreshold","eventName"],"mappings":"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","ignoreList":[0]}
{"version":3,"sources":["../../../src/lib/typescript/getTypeScriptIntent.ts"],"sourcesContent":["import { existsSync, readFileSync } from 'fs'\nimport path from 'path'\nimport { recursiveReadDir } from '../recursive-readdir'\n\nexport type TypeScriptIntent = { firstTimeSetup: boolean }\n\nexport async function getTypeScriptIntent(\n  baseDir: string,\n  intentDirs: string[],\n  tsconfigPath: string\n): Promise<TypeScriptIntent | false> {\n  const resolvedTsConfigPath = path.join(baseDir, tsconfigPath)\n\n  // The integration turns on if we find a `tsconfig.json` in the user's\n  // project.\n  const hasTypeScriptConfiguration = existsSync(resolvedTsConfigPath)\n  if (hasTypeScriptConfiguration) {\n    const content = readFileSync(resolvedTsConfigPath, {\n      encoding: 'utf8',\n    }).trim()\n\n    return { firstTimeSetup: content === '' || content === '{}' }\n  }\n\n  // Next.js also offers a friendly setup mode that bootstraps a TypeScript\n  // project for the user when we detect TypeScript files. So, we need to check\n  // the `pages/` directory for a TypeScript file.\n  // Checking all directories is too slow, so this is a happy medium.\n  const tsFilesRegex = /.*\\.(ts|tsx)$/\n  const excludedRegex = /(node_modules|.*\\.d\\.ts$)/\n  for (const dir of intentDirs) {\n    const typescriptFiles = await recursiveReadDir(dir, {\n      pathnameFilter: (name) => tsFilesRegex.test(name),\n      ignoreFilter: (name) => excludedRegex.test(name),\n    })\n    if (typescriptFiles.length) {\n      return { firstTimeSetup: true }\n    }\n  }\n\n  return false\n}\n"],"names":["existsSync","readFileSync","path","recursiveReadDir","getTypeScriptIntent","baseDir","intentDirs","tsconfigPath","resolvedTsConfigPath","join","hasTypeScriptConfiguration","content","encoding","trim","firstTimeSetup","tsFilesRegex","excludedRegex","dir","typescriptFiles","pathnameFilter","name","test","ignoreFilter","length"],"mappings":"AAAA,SAASA,UAAU,EAAEC,YAAY,QAAQ,KAAI;AAC7C,OAAOC,UAAU,OAAM;AACvB,SAASC,gBAAgB,QAAQ,uBAAsB;AAIvD,OAAO,eAAeC,oBACpBC,OAAe,EACfC,UAAoB,EACpBC,YAAoB;IAEpB,MAAMC,uBAAuBN,KAAKO,IAAI,CAACJ,SAASE;IAEhD,sEAAsE;IACtE,WAAW;IACX,MAAMG,6BAA6BV,WAAWQ;IAC9C,IAAIE,4BAA4B;QAC9B,MAAMC,UAAUV,aAAaO,sBAAsB;YACjDI,UAAU;QACZ,GAAGC,IAAI;QAEP,OAAO;YAAEC,gBAAgBH,YAAY,MAAMA,YAAY;QAAK;IAC9D;IAEA,yEAAyE;IACzE,6EAA6E;IAC7E,gDAAgD;IAChD,mEAAmE;IACnE,MAAMI,eAAe;IACrB,MAAMC,gBAAgB;IACtB,KAAK,MAAMC,OAAOX,WAAY;QAC5B,MAAMY,kBAAkB,MAAMf,iBAAiBc,KAAK;YAClDE,gBAAgB,CAACC,OAASL,aAAaM,IAAI,CAACD;YAC5CE,cAAc,CAACF,OAASJ,cAAcK,IAAI,CAACD;QAC7C;QACA,IAAIF,gBAAgBK,MAAM,EAAE;YAC1B,OAAO;gBAAET,gBAAgB;YAAK;QAChC;IACF;IAEA,OAAO;AACT","ignoreList":[0]}
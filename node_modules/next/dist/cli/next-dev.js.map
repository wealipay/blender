{"version":3,"sources":["../../src/cli/next-dev.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport '../server/lib/cpu-profile'\nimport type { StartServerOptions } from '../server/lib/start-server'\nimport {\n  RESTART_EXIT_CODE,\n  getNodeDebugType,\n  getParsedDebugAddress,\n  getMaxOldSpaceSize,\n  getParsedNodeOptionsWithoutInspect,\n  printAndExit,\n  formatNodeOptions,\n  formatDebugAddress,\n} from '../server/lib/utils'\nimport * as Log from '../build/output/log'\nimport { getProjectDir } from '../lib/get-project-dir'\nimport { PHASE_DEVELOPMENT_SERVER } from '../shared/lib/constants'\nimport path from 'path'\nimport type { NextConfigComplete } from '../server/config-shared'\nimport { traceGlobals } from '../trace/shared'\nimport { Telemetry } from '../telemetry/storage'\nimport loadConfig from '../server/config'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport { fileExists, FileType } from '../lib/file-exists'\nimport { getNpxCommand } from '../lib/helpers/get-npx-command'\nimport { createSelfSignedCertificate } from '../lib/mkcert'\nimport type { SelfSignedCertificate } from '../lib/mkcert'\nimport uploadTrace from '../trace/upload-trace'\nimport { initialEnv } from '@next/env'\nimport { fork } from 'child_process'\nimport type { ChildProcess } from 'child_process'\nimport {\n  getReservedPortExplanation,\n  isPortIsReserved,\n} from '../lib/helpers/get-reserved-port'\nimport os from 'os'\nimport { once } from 'node:events'\nimport { clearTimeout } from 'timers'\nimport { flushAllTraces, trace } from '../trace'\nimport { traceId } from '../trace/shared'\nimport {\n  Bundler,\n  finalizeBundlerFromConfig,\n  parseBundlerArgs,\n} from '../lib/bundler'\n\nexport type NextDevOptions = {\n  disableSourceMaps: boolean\n  turbo?: boolean\n  turbopack?: boolean\n  webpack?: boolean\n  port: number\n  hostname?: string\n  experimentalHttps?: boolean\n  experimentalHttpsKey?: string\n  experimentalHttpsCert?: string\n  experimentalHttpsCa?: string\n  experimentalUploadTrace?: string\n  experimentalNextConfigStripTypes?: boolean\n}\n\ntype PortSource = 'cli' | 'default' | 'env'\n\nlet dir: string\nlet child: undefined | ChildProcess\n// The config in next-dev is only used to access config.distDir for telemetry and trace.\nlet config: NextConfigComplete\nlet bundler: Bundler\nlet traceUploadUrl: string\nlet sessionStopHandled = false\nconst sessionStarted = Date.now()\nconst sessionSpan = trace('next-dev')\n\n// How long should we wait for the child to cleanly exit after sending\n// SIGINT/SIGTERM to the child process before sending SIGKILL?\nconst CHILD_EXIT_TIMEOUT_MS = parseInt(\n  process.env.NEXT_EXIT_TIMEOUT_MS ?? '100',\n  10\n)\n\nconst handleSessionStop = async (signal: NodeJS.Signals | number | null) => {\n  if (signal != null && child?.pid) child.kill(signal)\n  if (sessionStopHandled) return\n  sessionStopHandled = true\n\n  // Capture the child's exit code if it has already exited and caused the\n  // session stop (via the 'exit' event), otherwise assume success (0).\n  const exitCode = child?.exitCode || 0\n\n  if (\n    signal != null &&\n    child?.pid &&\n    child.exitCode === null &&\n    child.signalCode === null\n  ) {\n    let exitTimeout = setTimeout(() => {\n      child?.kill('SIGKILL')\n    }, CHILD_EXIT_TIMEOUT_MS)\n    await once(child, 'exit').catch(() => {})\n    clearTimeout(exitTimeout)\n  }\n\n  sessionSpan.stop()\n  await flushAllTraces({ end: true })\n\n  try {\n    const { eventCliSessionStopped } =\n      require('../telemetry/events/session-stopped') as typeof import('../telemetry/events/session-stopped')\n\n    let pagesDir: boolean = !!traceGlobals.get('pagesDir')\n    let appDir: boolean = !!traceGlobals.get('appDir')\n\n    if (\n      typeof traceGlobals.get('pagesDir') === 'undefined' ||\n      typeof traceGlobals.get('appDir') === 'undefined'\n    ) {\n      const pagesResult = findPagesDir(dir)\n      appDir = !!pagesResult.appDir\n      pagesDir = !!pagesResult.pagesDir\n    }\n\n    config =\n      config ||\n      (await loadConfig(PHASE_DEVELOPMENT_SERVER, dir, { silent: true }))\n\n    let telemetry =\n      (traceGlobals.get('telemetry') as InstanceType<\n        typeof import('../telemetry/storage').Telemetry\n      >) ||\n      new Telemetry({\n        distDir: path.join(dir, config.distDir),\n      })\n    // Reading the config can modify environment variables that influence the bundler selection.\n    bundler = finalizeBundlerFromConfig(bundler)\n\n    telemetry.record(\n      eventCliSessionStopped({\n        cliCommand: 'dev',\n        turboFlag: bundler === Bundler.Turbopack,\n        durationMilliseconds: Date.now() - sessionStarted,\n        pagesDir,\n        appDir,\n      }),\n      true\n    )\n    telemetry.flushDetached('dev', dir)\n  } catch (_) {\n    // errors here aren't actionable so don't add\n    // noise to the output\n  }\n\n  if (traceUploadUrl) {\n    uploadTrace({\n      traceUploadUrl,\n      mode: 'dev',\n      projectDir: dir,\n      distDir: config.distDir,\n      isTurboSession: bundler === Bundler.Turbopack,\n    })\n  }\n\n  // ensure we re-enable the terminal cursor before exiting\n  // the program, or the cursor could remain hidden\n  process.stdout.write('\\x1B[?25h')\n  process.stdout.write('\\n')\n  process.exit(exitCode)\n}\n\nprocess.on('SIGINT', () => handleSessionStop('SIGINT'))\nprocess.on('SIGTERM', () => handleSessionStop('SIGTERM'))\n\n// exit event must be synchronous\nprocess.on('exit', () => child?.kill('SIGKILL'))\n\nconst nextDev = async (\n  options: NextDevOptions,\n  portSource: PortSource,\n  directory?: string\n) => {\n  bundler = parseBundlerArgs(options)\n\n  dir = getProjectDir(process.env.NEXT_PRIVATE_DEV_DIR || directory)\n\n  // Check if pages dir exists and warn if not\n  if (!(await fileExists(dir, FileType.Directory))) {\n    printAndExit(`> No such directory exists as the project root: ${dir}`)\n  }\n\n  async function preflight(skipOnReboot: boolean) {\n    const { getPackageVersion, getDependencies } = (await Promise.resolve(\n      require('../lib/get-package-version') as typeof import('../lib/get-package-version')\n    )) as typeof import('../lib/get-package-version')\n\n    const [sassVersion, nodeSassVersion] = await Promise.all([\n      getPackageVersion({ cwd: dir, name: 'sass' }),\n      getPackageVersion({ cwd: dir, name: 'node-sass' }),\n    ])\n    if (sassVersion && nodeSassVersion) {\n      Log.warn(\n        'Your project has both `sass` and `node-sass` installed as dependencies, but should only use one or the other. ' +\n          'Please remove the `node-sass` dependency from your project. ' +\n          ' Read more: https://nextjs.org/docs/messages/duplicate-sass'\n      )\n    }\n\n    if (!skipOnReboot) {\n      const { dependencies, devDependencies } = await getDependencies({\n        cwd: dir,\n      })\n\n      // Warn if @next/font is installed as a dependency. Ignore `workspace:*` to not warn in the Next.js monorepo.\n      if (\n        dependencies['@next/font'] ||\n        (devDependencies['@next/font'] &&\n          devDependencies['@next/font'] !== 'workspace:*')\n      ) {\n        const command = getNpxCommand(dir)\n        Log.warn(\n          'Your project has `@next/font` installed as a dependency, please use the built-in `next/font` instead. ' +\n            'The `@next/font` package will be removed in Next.js 14. ' +\n            `You can migrate by running \\`${command} @next/codemod@latest built-in-next-font .\\`. Read more: https://nextjs.org/docs/messages/built-in-next-font`\n        )\n      }\n    }\n  }\n\n  let port = options.port\n\n  if (isPortIsReserved(port)) {\n    printAndExit(getReservedPortExplanation(port), 1)\n  }\n\n  // If neither --port nor PORT were specified, it's okay to retry new ports.\n  const allowRetry = portSource === 'default'\n\n  // We do not set a default host value here to prevent breaking\n  // some set-ups that rely on listening on other interfaces\n  const host = options.hostname\n\n  if (\n    options.experimentalUploadTrace &&\n    !process.env.NEXT_TRACE_UPLOAD_DISABLED\n  ) {\n    traceUploadUrl = options.experimentalUploadTrace\n  }\n\n  const devServerOptions: StartServerOptions = {\n    dir,\n    port,\n    allowRetry,\n    isDev: true,\n    hostname: host,\n  }\n\n  const startServerPath = require.resolve('../server/lib/start-server')\n\n  async function startServer(startServerOptions: StartServerOptions) {\n    return new Promise<void>((resolve) => {\n      let resolved = false\n      const defaultEnv = (initialEnv || process.env) as typeof process.env\n\n      const nodeOptions = getParsedNodeOptionsWithoutInspect()\n      const nodeDebugType = getNodeDebugType()\n\n      let maxOldSpaceSize: string | number | undefined = getMaxOldSpaceSize()\n      if (!maxOldSpaceSize && !process.env.NEXT_DISABLE_MEM_OVERRIDE) {\n        const totalMem = os.totalmem()\n        const totalMemInMB = Math.floor(totalMem / 1024 / 1024)\n        maxOldSpaceSize = Math.floor(totalMemInMB * 0.5).toString()\n\n        nodeOptions['max-old-space-size'] = maxOldSpaceSize\n\n        // Ensure the max_old_space_size is not also set.\n        delete nodeOptions['max_old_space_size']\n      }\n\n      if (options.disableSourceMaps) {\n        delete nodeOptions['enable-source-maps']\n      } else {\n        nodeOptions['enable-source-maps'] = true\n      }\n\n      if (nodeDebugType) {\n        const address = getParsedDebugAddress()\n        address.port = address.port === 0 ? 0 : address.port + 1\n        nodeOptions[nodeDebugType] = formatDebugAddress(address)\n      }\n\n      child = fork(startServerPath, {\n        stdio: 'inherit',\n        env: {\n          ...defaultEnv,\n          ...(bundler === Bundler.Turbopack\n            ? { TURBOPACK: process.env.TURBOPACK }\n            : undefined),\n          NEXT_PRIVATE_WORKER: '1',\n          NEXT_PRIVATE_TRACE_ID: traceId,\n          NODE_EXTRA_CA_CERTS: startServerOptions.selfSignedCertificate\n            ? startServerOptions.selfSignedCertificate.rootCA\n            : defaultEnv.NODE_EXTRA_CA_CERTS,\n          NODE_OPTIONS: formatNodeOptions(nodeOptions),\n          // There is a node.js bug on MacOS which causes closing file watchers to be really slow.\n          // This limits the number of watchers to mitigate the issue.\n          // https://github.com/nodejs/node/issues/29949\n          WATCHPACK_WATCHER_LIMIT:\n            os.platform() === 'darwin' ? '20' : undefined,\n        },\n      })\n\n      child.on('message', (msg: any) => {\n        if (msg && typeof msg === 'object') {\n          if (msg.nextWorkerReady) {\n            child?.send({ nextWorkerOptions: startServerOptions })\n          } else if (msg.nextServerReady && !resolved) {\n            if (msg.port) {\n              // Store the used port in case a random one was selected, so that\n              // it can be re-used on automatic dev server restarts.\n              port = parseInt(msg.port, 10)\n            }\n\n            resolved = true\n            resolve()\n          }\n        }\n      })\n\n      child.on('exit', async (code, signal) => {\n        if (sessionStopHandled || signal) {\n          return\n        }\n        if (code === RESTART_EXIT_CODE) {\n          // Starting the dev server will overwrite the `.next/trace` file, so we\n          // must upload the existing contents before restarting the server to\n          // preserve the metrics.\n          if (traceUploadUrl) {\n            // Postpone loading next config when we need to get\n            //  config.distDir for upload trace.\n            config =\n              config ||\n              (await loadConfig(PHASE_DEVELOPMENT_SERVER, dir, {\n                silent: true,\n              }))\n            bundler = finalizeBundlerFromConfig(bundler)\n            uploadTrace({\n              traceUploadUrl,\n              mode: 'dev',\n              projectDir: dir,\n              distDir: config.distDir,\n              isTurboSession: bundler === Bundler.Turbopack,\n              sync: true,\n            })\n          }\n\n          return startServer({ ...startServerOptions, port })\n        }\n        // Call handler (e.g. upload telemetry). Don't try to send a signal to\n        // the child, as it has already exited.\n        await handleSessionStop(/* signal */ null)\n      })\n    })\n  }\n\n  const runDevServer = async (reboot: boolean) => {\n    try {\n      if (!!options.experimentalHttps) {\n        Log.warn(\n          'Self-signed certificates are currently an experimental feature, use with caution.'\n        )\n\n        let certificate: SelfSignedCertificate | undefined\n\n        const key = options.experimentalHttpsKey\n        const cert = options.experimentalHttpsCert\n        const rootCA = options.experimentalHttpsCa\n\n        if (key && cert) {\n          certificate = {\n            key: path.resolve(key),\n            cert: path.resolve(cert),\n            rootCA: rootCA ? path.resolve(rootCA) : undefined,\n          }\n        } else {\n          certificate = await createSelfSignedCertificate(host)\n        }\n\n        await startServer({\n          ...devServerOptions,\n          selfSignedCertificate: certificate,\n        })\n      } else {\n        await startServer(devServerOptions)\n      }\n\n      await preflight(reboot)\n    } catch (err) {\n      console.error(err)\n      process.exit(1)\n    }\n  }\n\n  await runDevServer(false)\n}\n\nexport { nextDev }\n"],"names":["nextDev","dir","child","config","bundler","traceUploadUrl","sessionStopHandled","sessionStarted","Date","now","sessionSpan","trace","CHILD_EXIT_TIMEOUT_MS","parseInt","process","env","NEXT_EXIT_TIMEOUT_MS","handleSessionStop","signal","pid","kill","exitCode","signalCode","exitTimeout","setTimeout","once","catch","clearTimeout","stop","flushAllTraces","end","eventCliSessionStopped","require","pagesDir","traceGlobals","get","appDir","pagesResult","findPagesDir","loadConfig","PHASE_DEVELOPMENT_SERVER","silent","telemetry","Telemetry","distDir","path","join","finalizeBundlerFromConfig","record","cliCommand","turboFlag","Bundler","Turbopack","durationMilliseconds","flushDetached","_","uploadTrace","mode","projectDir","isTurboSession","stdout","write","exit","on","options","portSource","directory","parseBundlerArgs","getProjectDir","NEXT_PRIVATE_DEV_DIR","fileExists","FileType","Directory","printAndExit","preflight","skipOnReboot","getPackageVersion","getDependencies","Promise","resolve","sassVersion","nodeSassVersion","all","cwd","name","Log","warn","dependencies","devDependencies","command","getNpxCommand","port","isPortIsReserved","getReservedPortExplanation","allowRetry","host","hostname","experimentalUploadTrace","NEXT_TRACE_UPLOAD_DISABLED","devServerOptions","isDev","startServerPath","startServer","startServerOptions","resolved","defaultEnv","initialEnv","nodeOptions","getParsedNodeOptionsWithoutInspect","nodeDebugType","getNodeDebugType","maxOldSpaceSize","getMaxOldSpaceSize","NEXT_DISABLE_MEM_OVERRIDE","totalMem","os","totalmem","totalMemInMB","Math","floor","toString","disableSourceMaps","address","getParsedDebugAddress","formatDebugAddress","fork","stdio","TURBOPACK","undefined","NEXT_PRIVATE_WORKER","NEXT_PRIVATE_TRACE_ID","traceId","NODE_EXTRA_CA_CERTS","selfSignedCertificate","rootCA","NODE_OPTIONS","formatNodeOptions","WATCHPACK_WATCHER_LIMIT","platform","msg","nextWorkerReady","send","nextWorkerOptions","nextServerReady","code","RESTART_EXIT_CODE","sync","runDevServer","reboot","experimentalHttps","certificate","key","experimentalHttpsKey","cert","experimentalHttpsCert","experimentalHttpsCa","createSelfSignedCertificate","err","console","error"],"mappings":"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","ignoreList":[0]}